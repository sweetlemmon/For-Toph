<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat with Aurora ü¶≠</title>

  <!-- Cute Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:ital,wght@1,700&family=Quicksand:wght@500&display=swap" rel="stylesheet"/>

  <style>
    /* full‚Äêviewport container */
    html, body {
      height: 100%;
      margin: 0;
      background: linear-gradient(135deg, #e3f2fd, #80deea);
      font-family: 'Quicksand', 'Comic Neue', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      display: flex;
      flex-direction: column;
      width: 90%;
      max-width: 600px;
      height: 90vh;
      background: rgba(255,255,255,0.9);
      border-radius: 30px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      position: relative;
    }

    /* moving‚Äêwave background behind everything */
    .container::before {
      content: '';
      position: absolute;
      top: -20%; left: -20%;
      width: 140%; height: 140%;
      background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'><path fill='%2380deea' fill-opacity='0.3' d='M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,261.3C672,256,768,224,864,218.7C960,213,1056,235,1152,224C1248,213,1344,171,1392,149.3L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320,1056,320,960,320,864,320,768,320,672,320,576,320,480,320,384,320,288,320,192,320,96,320,48,320,0,320Z'></path></svg>") center/cover no-repeat;
      animation: drift 15s linear infinite;
      z-index: 0;
    }
    @keyframes drift {
      from { transform: translate(0,0) rotate(0deg) }
      to   { transform: translate(10%,10%) rotate(2deg) }
    }

    /* header always visible */
    header {
      flex: 0 0 auto;
      text-align: center;
      padding: 1.5rem 1rem 1rem;
      position: relative;
      z-index: 1;
    }
      header h1 {
        margin: 0; font-size: 2rem; color: #0288d1;
      }
      .subtitle {
        margin: .2rem 0 1rem; color: #006064; font-size: 1rem;
      }
      .welcome-bubble {
        display: inline-block;
        padding: .6rem 1rem;
        background: rgba(255,255,255,0.6);
        border-radius: 20px;
        border: 1px solid rgba(255,255,255,0.8);
        font-size: .95rem;
        color: #004d40;
      }

    /* chat + input area */
    .chat-wrapper {
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      min-height: 0;            /* allow flex children to overflow */
      position: relative;
      z-index: 1;
      padding: 0 1rem 1rem;
    }

    /* fixed-size chat scrollbox */
    #chat {
      flex: 1 1 auto;
      min-height: 0;            /* critical for consistent flex sizing */
      background: rgba(178,235,242,0.4);
      border-radius: 20px;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: .8rem;
      background-image: url('https://twemoji.maxcdn.com/v/latest/svg/1f9ad.svg');
      background-repeat: no-repeat;
      background-position: bottom right;
      background-size: 30px;
    }

    .message {
      max-width: 80%;
      padding: .8rem 1rem;
      border-radius: 20px;
      line-height: 1.4;
      font-size: .95rem;
      position: relative;
      animation: fadeIn .2s ease-out;
    }
      .message.user {
        align-self: flex-end;
        background: linear-gradient(135deg, #0288d1, #4dd0e1);
        color: white;
        border-bottom-right-radius: 5px;
      }
      .message.bot {
        align-self: flex-start;
        background: linear-gradient(135deg, #80deea, #4dd0e1);
        color: white;
        border-bottom-left-radius: 5px;
        animation: floatBot 3s ease-in-out infinite;
      }
      .message.thinking {
        background: rgba(255,255,255,0.7);
        color: #006064;
      }
      .message.thinking::after {
        content: 'üí≠üíß';
        position: absolute;
        right: 10px; bottom: 5px;
        font-size: 1.1rem;
        animation: floatBubbles 1.5s infinite ease-in-out;
      }
      .message.error {
        background: #ffebee;
        color: #c62828;
      }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px) }
      to   { opacity: 1; transform: translateY(0) }
    }
    @keyframes floatBot {
      0%,100% { transform: translateY(0) }
      50%     { transform: translateY(-4px) }
    }
    @keyframes floatBubbles {
      0%,100% { transform: translateY(0); opacity: 1 }
      50%     { transform: translateY(-6px); opacity: 0.7 }
    }

    /* input always visible at bottom */
    #input {
      flex: 0 0 auto;
      width: 100%;
      padding: .8rem 1rem;
      font-size: .95rem;
      border: none;
      border-radius: 25px;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
    }
    #input::placeholder { color: #81d4fa; }

    #status {
      text-align: center;
      font-size: .85rem;
      color: #006064;
      margin-top: .5rem;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>Chat with Aurora ü¶≠</h1>
      <p class="subtitle">Your friendly seal companion</p>
      <div class="welcome-bubble">üíô Hey Toph! Ready for some splashy chat? üåä</div>
    </header>

    <div class="chat-wrapper">
      <div id="chat"></div>
      <input id="input" type="text" placeholder="Say something to Aurora..." autocomplete="off"/>
      <div id="status">Ready to chat!</div>
    </div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('input');
    const status = document.getElementById('status');
    const BACKEND_URL = '/api/chat';

    function addMessage(text, sender, isThinking = false, isError = false) {
      const msg = document.createElement('div');
      msg.classList.add('message', sender);
      if (isThinking) msg.classList.add('thinking');
      if (isError) msg.classList.add('error');
      msg.innerHTML = `
        <div style="font-weight:bold; margin-bottom:4px;">
          ${sender==='bot'? 'ü¶≠ Aurora':'You'}
        </div>
        ${text}
      `;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
      return msg;
    }

    function updateStatus(txt, err=false) {
      status.textContent = txt;
      status.style.color = err ? '#c62828' : '#006064';
    }

    async function getAuroraReply(msg) {
      updateStatus('Aurora is swimming through waves...');
      const res = await fetch(BACKEND_URL, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({ message: msg })
      });
      if (!res.ok) {
        const e = await res.json().catch(()=>({}));
        throw new Error(e.error||res.statusText);
      }
      return (await res.json()).reply;
    }

    input.addEventListener('keydown', async e=>{
      if (e.key!=='Enter' || !input.value.trim()) return;
      const txt = input.value.trim();
      if (txt.length>300) {
        updateStatus('Too loooong! Try shorter splash üêö', true);
        return;
      }
      addMessage(txt, 'user');
      input.value=''; input.disabled=true;
      const think = addMessage('Aurora is thinking...', 'bot', true);
      try {
        const reply = await getAuroraReply(txt);
        chat.removeChild(think);
        addMessage(reply, 'bot');
        updateStatus('Aurora responded!');
      } catch(err) {
        chat.removeChild(think);
        addMessage('üåßÔ∏è Oops! Aurora can‚Äôt reach the ocean right now.', 'bot', false, true);
        updateStatus('Connection issue detected', true);
      } finally {
        input.disabled=false; input.focus();
      }
    });

    // initial greeting
    setTimeout(()=>{
      addMessage("Hi Toph! I'm Aurora ü¶≠ Ready to chat? üí¨", 'bot');
    },500);
    input.focus();
  </script>
</body>
</html>



